<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SAMBASHIVA MILK AGENCY</title>

  <style>
    :root {
      --orange: #ff7b00;
      --light-orange: #ffe7c2;
      --cream: #fffaf2;
      --white: #ffffff;
      --gray: #444;
    }
    * { box-sizing: border-box; }

    body {
      font-family: "Poppins", Arial, sans-serif;
      background-color: var(--cream);
      margin: 0;
      padding: 0;
      color: var(--gray);
    }

    header {
      background: linear-gradient(90deg, #ff7b00, #ff9a1f);
      color: white;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    header h1 {
      margin: 0;
      font-size: 1.3rem;
      font-weight: 700;
    }

    header p {
      margin: 0;
      font-size: 0.85rem;
    }

    header .logo {
      height: 40px;
      border-radius: 50%;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      color: var(--orange);
      font-weight: bold;
    }

    .top-controls {
      background: var(--white);
      padding: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    button {
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      color: white;
      background-color: var(--orange);
      transition: 0.2s;
    }
    button:hover { opacity: 0.85; }

    #downloadPDF { background: #008060; }
    #clearAll { background: #f44336; }
    #copyPrevDay { background: #ff9800; }
    #saveData { background: #4caf50; }

    input[type="date"] {
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 0.9rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: var(--white);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #f0f0f0;
      text-align: center;
      padding: 6px;
      font-size: 0.85rem;
      white-space: nowrap;
    }

    th {
      background: var(--light-orange);
      font-weight: 600;
      color: #222;
    }

    td[contenteditable="true"] {
      background-color: #fff8ee;
      outline: none;
    }

    td button {
      color: white;
      font-size: 0.75rem;
      padding: 4px 8px;
      margin: 0 2px;
      border-radius: 5px;
      cursor: pointer;
    }
    .send-btn { background: #28a745; }
    .edit-btn { background: #ffb300; }
    .delete-btn { background: #e53935; }

    tfoot td {
      background-color: #fff6e4;
      font-weight: bold;
    }

    footer {
      text-align: center;
      padding: 10px;
      color: #666;
      font-size: 0.8rem;
    }

    @media (max-width: 1024px) {
      table { font-size: 0.7rem; }
      header h1 { font-size: 1.1rem; }
    }
  </style>
</head>
<body>

  <header>
    <div class="logo">HAP</div>
    <div>
      <h1>SAMBASHIVA MILK AGENCY</h1>
      <p>Prop: <strong>K. AJAY KUMAR REDDY</strong> | Mobile: <strong>7330892694</strong></p>
    </div>
    <div class="logo">HAP</div>
  </header>

  <div class="top-controls">
    <input type="date" id="date" />
    <button id="addShop">+ Add Shop</button>
    <button id="copyPrevDay">Copy Prev Day</button>
    <button id="saveData">Save Data</button>
    <button id="downloadPDF">Download PDF</button>
    <button id="clearAll">Clear All</button>
  </div>

  <table id="milkTable">
    <thead>
      <tr>
        <th>Shop</th>
        <th>Mobile</th>
        <th>TM</th>
        <th>SM</th>
        <th>SML M</th>
        <th>SML C</th>
        <th>A400</th>
        <th>H500</th>
        <th>FCM</th>
        <th>FC1L</th>
        <th>Total</th>
        <th>Paid</th>
        <th>Due</th>
        <th>Send</th>
        <th>Edit</th>
        <th>Delete</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
    <tfoot>
      <tr>
        <td colspan="2">Total Sold</td>
        <td id="soldTM">0</td>
        <td id="soldSM">0</td>
        <td id="soldSMLM">0</td>
        <td id="soldSMLC">0</td>
        <td id="soldA400">0</td>
        <td id="soldH500">0</td>
        <td id="soldFCM">0</td>
        <td id="soldFC1L">0</td>
        <td colspan="6"></td>
      </tr>
    </tfoot>
  </table>

  <footer>
    Saved locally â€” persists per day. Auto-calculates totals. Exports to A4 PDF with banner.
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const prices = { TM:57, SM:67, SMLM:45, SMLC:45, A400:70, H500:86, FCM:77, FC1L:76 };
    const tableBody = document.getElementById("tableBody");
    const dateInput = document.getElementById("date");
    dateInput.valueAsDate = new Date();

    function key() { return "milkData_" + dateInput.value; }

    function addRow(data = {}) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td contenteditable="true">${data.shop || ""}</td>
        <td contenteditable="true">${data.mobile || ""}</td>
        <td contenteditable="true">${data.TM || 0}</td>
        <td contenteditable="true">${data.SM || 0}</td>
        <td contenteditable="true">${data.SMLM || 0}</td>
        <td contenteditable="true">${data.SMLC || 0}</td>
        <td contenteditable="true">${data.A400 || 0}</td>
        <td contenteditable="true">${data.H500 || 0}</td>
        <td contenteditable="true">${data.FCM || 0}</td>
        <td contenteditable="true">${data.FC1L || 0}</td>
        <td>${data.total || 0}</td>
        <td contenteditable="true">${data.paid || 0}</td>
        <td>${data.due || 0}</td>
        <td><button class="send-btn">Send</button></td>
        <td><button class="edit-btn">Edit</button></td>
        <td><button class="delete-btn">Delete</button></td>
      `;
      tableBody.appendChild(tr);

      tr.querySelectorAll("[contenteditable]").forEach(td => {
        td.addEventListener("input", () => updateRow(tr));
      });

      tr.querySelector(".delete-btn").addEventListener("click", () => {
        tr.remove();
        saveData();
        updateTotals();
      });

      updateRow(tr);
    }

    function updateRow(tr) {
      const tds = tr.querySelectorAll("td");
      let total = 0;
      Object.keys(prices).forEach((k, i) => {
        total += (parseFloat(tds[i+2].innerText) || 0) * prices[k];
      });
      tds[10].innerText = total.toFixed(0);
      const paid = parseFloat(tds[11].innerText) || 0;
      tds[12].innerText = (total - paid).toFixed(0);
      saveData();
      updateTotals();
    }

    function saveData() {
      const rows = [...tableBody.children].map(tr => {
        const tds = tr.querySelectorAll("td");
        return {
          shop: tds[0].innerText,
          mobile: tds[1].innerText,
          TM: tds[2].innerText,
          SM: tds[3].innerText,
          SMLM: tds[4].innerText,
          SMLC: tds[5].innerText,
          A400: tds[6].innerText,
          H500: tds[7].innerText,
          FCM: tds[8].innerText,
          FC1L: tds[9].innerText,
          total: tds[10].innerText,
          paid: tds[11].innerText,
          due: tds[12].innerText
        };
      });
      localStorage.setItem(key(), JSON.stringify(rows));
    }

    function loadData() {
      const data = JSON.parse(localStorage.getItem(key())) || [];
      tableBody.innerHTML = "";
      data.forEach(d => addRow(d));
      updateTotals();
    }

    function updateTotals() {
      const totals = { TM:0, SM:0, SMLM:0, SMLC:0, A400:0, H500:0, FCM:0, FC1L:0 };
      [...tableBody.children].forEach(tr => {
        const tds = tr.querySelectorAll("td");
        Object.keys(totals).forEach((k,i)=> totals[k] += +tds[i+2].innerText || 0);
      });
      Object.keys(totals).forEach(k => document.getElementById("sold"+k).innerText = totals[k]);
    }

    document.getElementById("addShop").onclick = () => addRow();
    document.getElementById("clearAll").onclick = () => {
      if (confirm("Clear all data for this date?")) {
        localStorage.removeItem(key());
        tableBody.innerHTML = "";
        updateTotals();
      }
    };
    document.getElementById("copyPrevDay").onclick = () => {
      const prev = new Date(dateInput.value);
      prev.setDate(prev.getDate() - 1);
      const prevData = JSON.parse(localStorage.getItem("milkData_" + prev.toISOString().split("T")[0])) || [];
      if (prevData.length) {
        localStorage.setItem(key(), JSON.stringify(prevData));
        loadData();
        alert("Copied from previous day!");
      } else alert("No data found for previous day.");
    };
    document.getElementById("saveData").onclick = saveData;

    // PDF export
    document.getElementById("downloadPDF").onclick = async () => {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({ orientation: "portrait", unit: "pt", format: "a4" });
      const content = document.body;
      const canvas = await html2canvas(content, { scale: 1.4 });
      const imgData = canvas.toDataURL("image/png");
      const width = pdf.internal.pageSize.getWidth();
      const height = (canvas.height * width) / canvas.width;
      pdf.addImage(imgData, "PNG", 0, 0, width, height);
      pdf.save(`milk_${dateInput.value}.pdf`);
    };

    dateInput.addEventListener("change", loadData);
    loadData();
  </script>
</body>
</html>
